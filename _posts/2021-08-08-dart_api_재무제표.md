---
title: 재무제표 데이터베이스 구축하기(0)
date: 2021-08-08
categories: project python 
---
### OpenDartReader 라이브러리를 활용한 재무제표 분석  
[OpenDartReader/github](https://github.com/FinanceData/OpenDartReader)  
  
### 단일회사 분기별 재무제표 병합하기 
전체코드 [finstate.py/github](https://github.com/yeonseo-Jung/project_finance/blob/aca4af282fedc2452e5f95f44f3d58ab07d4f09a/finstate.py)  
___

# project_finstate

## 재무제표 분석을 통한 
## 기업 분석 및 기업가치 평가 & 포트폴리오 구성 프로그램

### 필요한 기능

* 수정과 병합이 용이한 단일회사에 대한 분기별 재무제표
* 단일 회사에 대한 사업연도별, 분기별로 원하는 계정과목의 정확한 금액 호출
* 단일 회사에 대한 지배구조, 주주 현황, 임직원 현황,  자기주식 및 유통 주식 수 파악

### tables 
  
* corp_info (DataFrame) : 회사의 기본정보 table  

    columns = [stock_name, stock_code, corp_code] (리스트의 각 원소 자료형: string)

    key = stock_name

* fstate_all_account (DataFrame) : 단일회사 사업연도별, 분기별 전체 재무제표(BS, IS, CIS, CF)를 병합한 table  

    columns_0 = [stock_name, stock_code, corp_code] (리스트의 각 원소 자료형: string)

    columns_1 = [sj_div, account_id, account_nm] (리스트의 각 원소 자료형: string)

    columns_2 = [thstrm_amount_2021_1, thstrm_amount_2021_2, thstrm_amount_2020_1, thstrm_amount_2020_2, ...] (리스트의 각 원소 자료형: float32) ⇒ 최근 4개년치 분기별 금액

    병합(join) 기준 key = ["sj_div", "account_id", "account_nm"]

#### 병합 이후 문제점  
각 분기별 재무제표에서 같은 계정과목에 대해서 ("account_id", "account_nm")이 다르게 명시되어있는 경우가 많음   

예를들면 "지배기업 소유주에 귀속되는 당기순이익" 계정과목에 대해서   

("ifrs_ProfitLossAttributableToOwnersOfParent", "지배기업 소유주 지분")도 존재하고,  

("ifrs-full_ProfitLossAttributableToOwnersOfParent", "지배기업 귀속 당기순이익")도 존재한다.   

즉, 회사별 재무제표 table에서 일반키 지정이 불가능한 상황이 된다.   

이를 해결하기 위해 병합한 회사별 재무제표 table 자체를 수정하기 보단   

계정과목의 "account_id"를 기준으로 row데이터를 추출하여 새로운 table에 할당해보기로 했다.  
  
  
* fstate_core_account (DataFrame) : 다중회사의 특정 계정과목에 대한 분기별 금액 table  

    columns_0 = [stock_name, stock_code, corp_code, account] (리스트의 각 원소 자료형: string)

    columns_1 = [thstrm_amount_2021_1, thstrm_amount_2021_2, thstrm_amount_2020_1, thstrm_amount_2020_2, ...] (리스트의 각 원소 자료형: float32) ⇒ 최근 4개년치 분기별 금액  
      
* accounts (dictionary) : 계정과목 이름(key), 계정과목 id(value) 구조의 딕셔너리, 회사별, 분기별로 다른 계정과목 이름과 id 때문에 필요함  

    key = account_nm (string)  

    value = [account_id, ...] (리스트의 각 원소 자료형: string)
