---
title: 재무제표 데이터베이스 구축하기(0)
date: 2021-08-08
categories: project python 
---
### OpenDartReader 라이브러리를 활용한 재무제표 분석  
Click [OpenDartReader/github](https://github.com/FinanceData/OpenDartReader)  
  
### 단일회사 분기별 재무제표 병합하기 
Click [전체코드/finstate.py/github](https://github.com/yeonseo-Jung/project_finance/blob/aca4af282fedc2452e5f95f44f3d58ab07d4f09a/finstate.py)
#### code
___

```python
finstate_2020 = pd.DataFrame()
i = 0
for s in corp_info.corp_name:
    if s == "삼성전자":
        corp_code = corp_info.loc[i, "corp_code"]
        api_key = "ef3149d745caee09f48df5004b905ec4ef3f5d7e"   
        bsns_year = "2020"
        
        # 분기별 재무제표를 DataFrame에 할당
        data_01 = finstate_all(api_key, corp_code, bsns_year, "11013", fs_div="CFS")[["corp_code", "bsns_year", "sj_div", "account_id", "account_nm", "thstrm_amount"]]
        # 재무제표에서 자본변동표(SCE) 삭제
        rev_data = list(reversed(data_01.index))
        del_row = []
        for i in rev_data:
            if data_01.loc[i, "sj_div"] == "SCE":
                del_row.append(i)
        data_01 = data_01.drop(index=del_row)
        finstate_01 = pd.DataFrame(data_01, columns=["corp_code", "bsns_year", "sj_div", "account_id", "account_nm", "thstrm_amount"])
        finstate_01["thstrm_amount"] = pd.to_numeric(finstate_01.thstrm_amount, errors="coerce", downcast="float")
        
        data_02 = finstate_all(api_key, corp_code, bsns_year, "11012", fs_div="CFS")[["corp_code", "bsns_year", "sj_div", "account_id", "account_nm", "thstrm_amount"]]
        rev_data = list(reversed(data_02.index))
        del_row = []
        for i in rev_data:
            if data_02.loc[i, "sj_div"] == "SCE":
                del_row.append(i)
        data_02 = data_02.drop(index=del_row)
        finstate_02 = pd.DataFrame(data_02, columns=["corp_code", "bsns_year", "sj_div", "account_id", "account_nm", "thstrm_amount"])
        finstate_02["thstrm_amount"] = pd.to_numeric(finstate_02.thstrm_amount, errors="coerce", downcast="float")
        
        data_03 = finstate_all(api_key, corp_code, bsns_year, "11014", fs_div="CFS")[["corp_code", "bsns_year", "sj_div", "account_id", "account_nm", "thstrm_amount"]]
        rev_data = list(reversed(data_03.index))
        del_row = []
        for i in rev_data:
            if data_03.loc[i, "sj_div"] == "SCE":
                del_row.append(i)
        data_03 = data_03.drop(index=del_row)
        finstate_03 = pd.DataFrame(data_03, columns=["corp_code", "bsns_year", "sj_div", "account_id", "account_nm", "thstrm_amount"])        
        finstate_03["thstrm_amount"] = pd.to_numeric(finstate_03.thstrm_amount, errors="coerce", downcast="float")
        
        data_00 = finstate_all(api_key, corp_code, bsns_year, "11011", fs_div="CFS")[["corp_code", "bsns_year", "sj_div", "account_id", "account_nm", "thstrm_amount"]]
        rev_data = list(reversed(data_00.index))
        del_row = []
        for i in rev_data:
            if data_00.loc[i, "sj_div"] == "SCE":
                del_row.append(i)
        data_00 = data_00.drop(index=del_row)
        finstate_00 = pd.DataFrame(data_00, columns=["corp_code", "bsns_year", "sj_div", "account_id", "account_nm", "thstrm_amount"])
        finstate_00["thstrm_amount"] = pd.to_numeric(finstate_00.thstrm_amount, errors="coerce", downcast="float")
        
    i += 1
```


```python
# 1, 2, 3분기 재무제표와 사업보고서를 행으로 합치기(merge) 
finstate_2020 = finstate_01.merge(finstate_02, how="outer", on=["corp_code", "bsns_year", "sj_div", "account_id", "account_nm"], suffixes=("_01", "_02"))
finstate_2020 = finstate_2020.merge(finstate_03, how="outer", on=["corp_code", "bsns_year", "sj_div", "account_id", "account_nm"], suffixes=("", ""))
finstate_2020 = finstate_2020.merge(finstate_00, how="outer", on=["corp_code", "bsns_year", "sj_div", "account_id", "account_nm"], suffixes=("_03", "_00"))
```


```python
# scala 연산을 위해 NaN값을 0으로 변경
finstate_2020 = finstate_2020.fillna(0)
```


```python
i = 0
for s in finstate_2020.sj_div:
    if s == "BS":
        finstate_2020.loc[i, "thstrm_amount_04"] = finstate_2020.loc[i, "thstrm_amount_00"]
    else:
        finstate_2020.loc[i, "thstrm_amount_04"] = finstate_2020.loc[i, "thstrm_amount_00"] - finstate_2020.loc[i, "thstrm_amount_03"]
    i += 1
```


```python
finstate_2020.drop(columns="thstrm_amount_00")
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>corp_code</th>
      <th>bsns_year</th>
      <th>sj_div</th>
      <th>account_id</th>
      <th>account_nm</th>
      <th>thstrm_amount_01</th>
      <th>thstrm_amount_02</th>
      <th>thstrm_amount_03</th>
      <th>thstrm_amount_04</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>00126380</td>
      <td>2020</td>
      <td>BS</td>
      <td>ifrs-full_CurrentAssets</td>
      <td>유동자산</td>
      <td>1.867397e+14</td>
      <td>1.861369e+14</td>
      <td>2.036349e+14</td>
      <td>1.982156e+14</td>
    </tr>
    <tr>
      <th>1</th>
      <td>00126380</td>
      <td>2020</td>
      <td>BS</td>
      <td>ifrs-full_CashAndCashEquivalents</td>
      <td>현금및현금성자산</td>
      <td>2.791668e+13</td>
      <td>3.610961e+13</td>
      <td>2.656610e+13</td>
      <td>2.938258e+13</td>
    </tr>
    <tr>
      <th>2</th>
      <td>00126380</td>
      <td>2020</td>
      <td>BS</td>
      <td>dart_ShortTermDepositsNotClassifiedAsCashEquiv...</td>
      <td>단기금융상품</td>
      <td>7.863802e+13</td>
      <td>7.512761e+13</td>
      <td>8.969403e+13</td>
      <td>9.244171e+13</td>
    </tr>
    <tr>
      <th>3</th>
      <td>00126380</td>
      <td>2020</td>
      <td>BS</td>
      <td>-표준계정코드 미사용-</td>
      <td>단기상각후원가금융자산</td>
      <td>3.037379e+12</td>
      <td>1.224565e+12</td>
      <td>1.684068e+12</td>
      <td>2.757111e+12</td>
    </tr>
    <tr>
      <th>4</th>
      <td>00126380</td>
      <td>2020</td>
      <td>BS</td>
      <td>ifrs-full_CurrentFinancialAssetsAtFairValueThr...</td>
      <td>단기당기손익-공정가치금융자산</td>
      <td>1.238759e+12</td>
      <td>5.826410e+11</td>
      <td>5.961220e+11</td>
      <td>7.145100e+10</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>124</th>
      <td>00126380</td>
      <td>2020</td>
      <td>CF</td>
      <td>dart_RepaymentsOfLongTermBorrowings</td>
      <td>사채 및 장기차입금의 상환</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>6.727550e+11</td>
      <td>1.921920e+11</td>
    </tr>
    <tr>
      <th>125</th>
      <td>00126380</td>
      <td>2020</td>
      <td>CF</td>
      <td>-표준계정코드 미사용-</td>
      <td>매각예정분류</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>-4.471000e+10</td>
      <td>4.457100e+10</td>
    </tr>
    <tr>
      <th>126</th>
      <td>00126380</td>
      <td>2020</td>
      <td>BS</td>
      <td>-표준계정코드 미사용-</td>
      <td>상각후원가금융자산</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>127</th>
      <td>00126380</td>
      <td>2020</td>
      <td>CF</td>
      <td>dart_AcquisitionOfTreasuryShares</td>
      <td>자기주식의 취득</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>128</th>
      <td>00126380</td>
      <td>2020</td>
      <td>CF</td>
      <td>-표준계정코드 미사용-</td>
      <td>장기차입금의 차입</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>1.449500e+10</td>
    </tr>
  </tbody>
</table>
<p>129 rows × 9 columns</p>
</div>


